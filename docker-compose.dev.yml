# ==============================================================================
# DOCKER COMPOSE DEV - DEVELOPMENT WITH HOT RELOAD
# ==============================================================================
# Jalankan dengan: docker compose -f docker-compose.dev.yml up --build
# ==============================================================================

version: '3.8'

services:
  jobmate-dev:
    container_name: jobmate-dev
    build:
      context: .
      dockerfile: Dockerfile.dev
    
    # Port mapping (Next.js dev runs on port 3001)
    ports:
      - "3005:3001"
    
    # Environment variables
    environment:
      - NODE_ENV=development
      - NEXT_PUBLIC_BASE_URL=http://localhost:3005
      - NEXT_PUBLIC_APP_URL=http://localhost:3005
      
      # Supabase
      - NEXT_PUBLIC_SUPABASE_URL=${NEXT_PUBLIC_SUPABASE_URL}
      - NEXT_PUBLIC_SUPABASE_ANON_KEY=${NEXT_PUBLIC_SUPABASE_ANON_KEY}
      - SUPABASE_SERVICE_ROLE_KEY=${SUPABASE_SERVICE_ROLE_KEY}
      
      # OpenAI
      - OPENAI_API_KEY=${OPENAI_API_KEY}
      - OPENAI_BASE_URL=${OPENAI_BASE_URL:-https://api.openai.com/v1}
      
      # Resend
      - RESEND_API_KEY=${RESEND_API_KEY}
      - RESEND_FROM_EMAIL=${RESEND_FROM_EMAIL:-noreply@yourdomain.com}
      
      # Telegram
      - TELEGRAM_BOT_TOKEN=${TELEGRAM_BOT_TOKEN}
      - TELEGRAM_ADMIN_CHAT_ID=${TELEGRAM_ADMIN_CHAT_ID}
      
      # Xendit
      - XENDIT_SECRET_KEY=${XENDIT_SECRET_KEY}
      - XENDIT_WEBHOOK_VERIFICATION_TOKEN=${XENDIT_WEBHOOK_VERIFICATION_TOKEN}
      
      # ILovePDF
      - ILOVEPDF_PUBLIC_KEY=${ILOVEPDF_PUBLIC_KEY}
      - ILOVEPDF_SECRET_KEY=${ILOVEPDF_SECRET_KEY}
      
      # Hot reload polling (untuk Windows/Docker)
      - WATCHPACK_POLLING=true
      - CHOKIDAR_USEPOLLING=true
    
    # VOLUME MOUNTING untuk Hot Reload
    volumes:
      # Mount source code (hot reload akan detect perubahan)
      - .:/app
      # Exclude node_modules (gunakan yang ada di container)
      - /app/node_modules
      # Exclude .next (biar container yang handle)
      - /app/.next
    
    # Restart policy
    restart: unless-stopped
    
    networks:
      - jobmate-dev-network

networks:
  jobmate-dev-network:
    driver: bridge
